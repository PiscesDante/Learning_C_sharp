# 第12章 数组

## 12.1 数组

数组实际上是由一个变量名称表示的一组同类型的数据元素。每个元素通过变量名称和一个或者多个方括号中的索引来访问。

### 12.1.1 定义

* **元素** ：数组的独立数据项称为元素。
* **秩** ：数组的维度称为秩（Rank）。
* **维度长度** ：数组的每一个维度有一个长度，就是这个方向的位置个数。
* **数组长度** ：数组的所有维度中的元素的总和称为数组的长度。

### 12.1.2 重要细节

* 数组一旦创建，大小就固定了。C#不支持动态数组。
* 数组的索引号是从`0`开始的。

## 12.2 数组的类型

* 一维数组可以认为是单行元素或者元素向量。
* 多维数组是由主向量中的位置组成的，每一个位置本身又是一个数组，称为子数组。子数组向量的中的每个位置本身又是一个数组。

## 12.3 数组是对象

数组实例是从`System.Array`继承的对象。

* `Rank`：返回数组维度数的属性。
* `Length`：返回数组长度的属性。

数组的引用在栈或者堆上，而数组对象本身总是在堆上。

* 如果存储的元素都是值类型，那么数组被称为值类型数组。
* 如果存储的都是引用类型对象，那么数组被称为引用类型数组。

## 12.4 一维数组和矩形数组

#### 声明一维数组或者矩形数组

要声明一维数组或者矩形数组，可以在类型和变量名称之间使用一对方括号。

方括号内的逗号就是 **秩说明符** ，指定了数组的维度数。**秩就是逗号数量加一** 。

```C#
long[] arr; // 如果方括号中是空的，那么默认是一维数组
int[,,] arr1; // 三维数组
int[,] arr2; // 二维数组

long[2, 4, 6] arr3; // 编译错误
```

数组声明后，维度数就是固定的了。然而，每个维度的长度直到数组实例化时才会确定。

## 12.5 实例化一维数组或者矩形数组

实例化数组可以使用数组创建表达式。数组创建表达式由`new`运算符构成，后面是基类名称和一对方括号。方括号中以逗号分隔每个维度的长度：

```C#
using System;

public class MyClass {  }

public class Program
{
    public static void Main(string[] args)
    {
        int[] arr1 = new int[4];
        int[,] arr2 = new int[2, 6];
        MyClass[] arr3 = new MyClass[5];
        Console.WriteLine("Arr1 Rank: {0}; Arr1 Length: {1}", arr1.Rank, arr1.Length);
        Console.WriteLine("Arr2 Rank: {0}; Arr2 Length: {1}", arr2.Rank, arr2.Length);
        Console.WriteLine("Arr3 Rank: {0}; Arr3 Length: {1}", arr3.Rank, arr3.Length);
    }
}

// Output:
// Arr1 Rank: 1; Arr1 Length: 4
// Arr2 Rank: 2; Arr2 Length: 12
// Arr3 Rank: 1; Arr3 Length: 5
```

数组创建表达式不包含圆括号，即使是对于引用类型的数组。

## 12.6 访问数组元素

```C#
int[] arr = new int[15];
arr[5] = 10; // 写入
Console.WriteLine(arr[5]); // 读取
```

## 12.7 初始化数组

当数组被创建之后，每一个元素被自动的初始化为类型的默认值。

### 12.7.1 显式初始化一维数组

在数组创建表达式之后加上一个初始化列表：

* 初始值必须以逗号分隔，并封闭在一组大括号内。
* 不必输入维度长度，因为编译器可以进行推断。
* 数组创建表达式和初始化列表中间没有分隔符。

```C#
int[] arr = new int[]{1,2,3,4,5};
```

### 12.7.2 显式初始化矩形数组

```C#
int[,] arr = new int[,] {
    {1,2,3,4,5},
    {6,7,8,9,10}
};
```

### 12.7.3 初始化矩形数组的语法点

### 12.7.4 快捷语法

```C#
int[] arr = new int[]{1,2,3,4};
int[] arr = {1,2,3,4}; // 等价于上一条，舍弃new关键字
```

### 12.7.5 隐式类型数组

```C#
int[] arr = new int[]{1,2,3,4,5};
var arr = new []{1,2,3,4,5}; // 效果同上一条

int[,] arr = new int[,]{ {1,2}, {3,4} };
var arr = new [,]{ {1,2}, {3,4} }; // 效果同上一条
```

### 12.7.6 综合内容

## 12.8 交错数组

交错数组是数组的数组。交错数组的子数组元素个数可以不同。

```C#
int[][] jagArr = new int[3][];
```

这里`jagArr`是3个`int`数组的数组。

### 12.8.1 声明交错数组

交错数组的声明语法要求每个维度都有一对独立的方括号。数组变量声明中的方括号数决定了数组的秩。

### 12.8.2 快捷实例化

```C#
int[][] arr = new int[3][]; // 允许
int[][] arr = new int[3][4]; // 编译错误，不能在声明语句中初始化顶层数组之外的数组
```

### 12.8.3 实例化交错数组

交错数组的完全初始化不能在一个步骤中完成。交错数组是独立的数组的数组，每一个数组必须独立创建。实例化完整的交错数组需要如下步骤：

* 首先，实例化顶层数组。
* 其次，分别实例化每一个子数组。

```C#
int[][] arrTop = new int[3][]; // 实例化顶层数组
arrTop[0] = new int[]{1,2,3}; // 分别实例化每个独立的元素数组
arrTop[1] = new int[]{1,2,3,4};
arrTop[2] = new int[]{1,2,3,4,5};
```

### 12.8.4 交错数组中的子数组

## 12.9 比较矩形数组和交错数组

在CIL中，一维数组有特定的指令用于性能优化。而矩形数组没有。

## 12.10 `foreach`语句

基本上就是C++中 `for (auto item : arr) { ... }` 的变种

```C#
int[] arr = new int[]{1,2,3,4,5,6};
foreach (var val in arr) { Console.WriteLine("Value: {0}", val); }
```

### 12.10.1 迭代变量是只读的

**<u>对于值类型的数组来说，迭代变量不能改变数组中的值。对于引用类型的数组，迭代变量能改变其引用的对象的值</u>**。

### 12.10.2 `foreach`语句和多维数组

```C#
using System;

public class Program
{
    public static void Main(string[] args)
    {
        int total = 0;
        int[,] arr = new int[2,3]{{1,2,3}, {4,5,6}};
        foreach (var elem in arr) {
            total += elem;
            Console.WriteLine("Element: {0}; Total: {1}.", elem, total);
        }
    }
}

// Output:
// Element: 1; Total: 1.
// Element: 2; Total: 3.
// Element: 3; Total: 6.
// Element: 4; Total: 10.
// Element: 5; Total: 15.
// Element: 6; Total: 21.
```

C#里面的`foreach`貌似比较智能。当然也可能是利用了数组的存储特性进行工作。

## 12.11 数组协变

某些情况下，即使某个对象不是数组的类型，我们也可以把它赋值给数组元素。在下面的情况下可以使用数组协变：

* 数组是引用类型数组。
* 在赋值的对象类型和数组基类类型之间有隐式转换或者显式转换。

## 12.12 数组继承的有用成员

#### `Clone`方法

`Clone`方法执行的是数组的**顶层复制**：

* 克隆值类型的数组会产生两个独立的数组。
* 克隆引用类型的数组会产生指向相同对象的两个数组。

## 12.13 比较数组类型